<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: newroute.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: newroute.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable linebreak-style */
/* eslint-disable no-undef */
/* eslint-disable semi */
/* eslint-disable func-names */

import express from 'express'
import debug from 'debug'
import jwt from 'jsonwebtoken'
import jsonpatch from 'jsonpatch'
import resize from 'node-image-resizer'
import bodyParser from 'body-parser'

const router = express.Router()
router.use(bodyParser.json())

/**
 * @param {object} verifyToken
 * @param {string} verifyToken.req [authorization]
 * @param {status} verifyToken.res [display error]
 * @param {string} verifyToken.next [token]
 */

const verifytoken = (req, res, next) => {
  const headertok = req.headers.authorization;
  /**
 *  login
 * @example
 * const user = ({
 *  "username": "king"
 *  "password": "play"
 *  "token": "secret"
 * })
 *
 * @see https://github.com/ibukunfolay
 * @todo verify token and render /post  /thumb
 */

  if (typeof headertok !== 'undefined') {
    const header = headertok.split(' ')
    const headerToken = header[1]
    req.token = headerToken;
    debug(headerToken)
    next()
  } else {
    res.sendStatus(403)
    debug(err)
  }
};

router.get('/', (req, res) => {
  res.json('Welcome JAuth');
  debug('Welcome JAuth')
});

router.post('/login', (req, res) => {
  const { body } = req;
  const username = body.name;
  const password = body.pass;

  const user = {
    username,
    password,
  };

  debug({ user })

  jwt.sign({ user }, 'Secret key', (err, token) => {
    res.json({
      token,
    });
    debug({ token })
  });
});

router.post('/post', verifytoken, (req, res) => {
  jwt.verify(req.token, 'Secret key', (err) => {
    if (err) {
      res.sendStatus(403)
      debug(err)
    } else {
      mydoc = {
        ibukun: 'folay',
        Hacker: 'bay',
      }
      debug({ mydoc })

      thepatch = [
        { op: 'replace', path: '/ibukun', value: 'King' },
      ]
      debug({ thepatch })

      patcheddoc = jsonpatch.apply_patch(mydoc, thepatch);
      res.json(patcheddoc);
      debug({ patcheddoc })
    }
  });
});

router.post('/thumb', verifytoken, (req, res) => {
  const setup = {
    all: {
      path: './public/thumbnails/',
      quality: 80,
    },
    versions: [{
      quality: 100,
      suffix: '_thumbnail',
      height: 50,
      width: 50,
    }],
  };
  jwt.verify(req.token, 'Secret key', (err) => {
    if (err) {
      res.sendStatus(403);
      debug(err)
    } else {
      (async function () {
        const thumbs = await resize('./public/15.jpg', setup);
        res.json({ thumbs })
        debug({ thumbs })
      }());
    }
  });
});

export default router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#verifytoken">verifytoken</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Oct 26 2020 22:35:59 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
